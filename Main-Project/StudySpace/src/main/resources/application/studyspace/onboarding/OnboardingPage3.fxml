<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<StackPane xmlns="http://javafx.com/javafx/23.0.1"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="application.studyspace.controllers.onboarding.OnboardingPage3Controller"
           stylesheets="@../styles/OnboardingStylesheet.css"
           style="-fx-background-color: transparent; -fx-padding: 40;"
           prefWidth="1600" prefHeight="1000">

    <fx:define>
        <ToggleGroup fx:id="paginationGroup"/>
        <ToggleGroup fx:id="colorGroup"/>
        <ToggleGroup fx:id="typeToggleGroup"/>
    </fx:define>

    <VBox spacing="20" alignment="TOP_CENTER"
          style="-fx-background-color: white; -fx-padding: 30; -fx-background-radius: 15;
                 -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.15), 12, 0, 0, 4);"
          prefWidth="1500" prefHeight="920"
          VBox.vgrow="ALWAYS">

        <HBox spacing="30" alignment="TOP_CENTER" VBox.vgrow="ALWAYS">

            <!-- LEFT CARD -->
            <VBox spacing="20" alignment="TOP_LEFT"
                  styleClass="card-box"
                  prefWidth="600"
                  HBox.hgrow="NEVER">

                <Label text="Add your exams and blockers"
                       style="-fx-font-size:22px; -fx-font-weight:bold;"/>

                <!-- Type toggles (wider) -->
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <ToggleButton fx:id="examToggle"
                                  text="Exam"
                                  toggleGroup="$typeToggleGroup"
                                  styleClass="type-toggle"/>
                    <ToggleButton fx:id="blockerToggle"
                                  text="Blocker"
                                  toggleGroup="$typeToggleGroup"
                                  styleClass="type-toggle"/>
                </HBox>

                <!-- Entry‐form container -->
                <StackPane fx:id="formContainer" prefWidth="560">

                    <!-- Exam form -->
                    <VBox fx:id="examForm" spacing="12" visible="false" managed="false">
                        <Label text="Exam Name" styleClass="field-label"/>
                        <TextField fx:id="examNameField"
                                   promptText="e.g. Calculus"
                                   styleClass="styled-text-field"/>

                        <Label text="Description" styleClass="field-label"/>
                        <TextArea fx:id="descriptionArea"
                                  promptText="e.g. Covers chapters 1-5"
                                  prefRowCount="4"
                                  styleClass="styled-text-area"/>

                        <Label text="Start Date" styleClass="field-label"/>
                        <DatePicker fx:id="exStartDate"
                                    promptText="Select start"
                                    styleClass="styled-combo"/>

                        <Label text="End Date" styleClass="field-label"/>
                        <DatePicker fx:id="exEndDate"
                                    promptText="Select end"
                                    styleClass="styled-combo"/>

                        <Label text="Estimated Study Minutes" styleClass="field-label"/>
                        <TextField fx:id="estimatedMinutesField"
                                   promptText="e.g. 120"
                                   styleClass="styled-text-field"/>

                        <!-- New Difficulty slider -->
                        <Label text="Difficulty" styleClass="field-label"/>
                        <Slider fx:id="difficultySlider"
                                min="1" max="10" value="5"
                                majorTickUnit="1" minorTickCount="0"
                                blockIncrement="1" snapToTicks="true"
                                styleClass="styled-slider"/>
                        <Label fx:id="difficultyLabel"
                               text="5"
                               styleClass="slider-value"/>

                        <!-- New Number of Topics field -->
                        <Label text="Number of Topics" styleClass="field-label"/>
                        <TextField fx:id="topicsField"
                                   promptText="e.g. 5"
                                   styleClass="styled-text-field"/>

                        <!-- New Grade Weight slider -->
                        <Label text="Grade Weight (%)" styleClass="field-label"/>
                        <Slider fx:id="weightSlider"
                                min="0" max="100" value="50"
                                majorTickUnit="10" minorTickCount="9"
                                blockIncrement="1" snapToTicks="true"
                                styleClass="styled-slider"/>
                        <Label fx:id="weightLabel"
                               text="50%"
                               styleClass="slider-value"/>

                    </VBox>

                    <!-- Blocker/Event form -->
                    <VBox fx:id="blockerForm" spacing="12" visible="false" managed="false">
                        <Label text="Event Title" styleClass="field-label"/>
                        <TextField fx:id="evtTitleField"
                                   promptText="e.g. Team Meeting"
                                   styleClass="styled-text-field"/>

                        <Label text="Location" styleClass="field-label"/>
                        <TextField fx:id="evtLocationField"
                                   promptText="e.g. Room 101"
                                   styleClass="styled-text-field"/>

                        <Label text="Start" styleClass="field-label"/>
                        <HBox spacing="6">
                            <DatePicker fx:id="evtStartDate"/>
                            <Spinner fx:id="evtStartTime" editable="true"/>
                        </HBox>

                        <Label text="End" styleClass="field-label"/>
                        <HBox spacing="6">
                            <DatePicker fx:id="evtEndDate"/>
                            <Spinner fx:id="evtEndTime" editable="true"/>
                        </HBox>

                        <CheckBox fx:id="evtAllDay" text="All day"/>
                    </VBox>

                </StackPane>
            </VBox>

            <!-- RIGHT CARD (Preview) -->
            <!-- RIGHT CARD (Preview) -->
            <VBox spacing="0"
                  alignment="TOP_CENTER"
                  styleClass="card-box"
                  prefWidth="900"
                  HBox.hgrow="ALWAYS"
                  VBox.vgrow="ALWAYS">

                <!-- (Optional header removed) -->

                <!-- Directly put the calendar container here and let it grow -->
                <StackPane fx:id="calendarPreviewContainer"
                           styleClass="calendar-wrapper"
                           HBox.hgrow="ALWAYS"
                           VBox.vgrow="ALWAYS"/>
            </VBox>
        </HBox>

        <Region VBox.vgrow="ALWAYS"/>

        <!-- Bottom pager + Save -->
        <HBox spacing="12" alignment="CENTER">
            <Button text="1" fx:id="page1Btn" onAction="#handlePage1" styleClass="page-button"/>
            <Button text="2" fx:id="page2Btn" onAction="#handlePage2" styleClass="page-button"/>
            <Button text="3" fx:id="page3Btn" onAction="#handlePage3" styleClass="page-button-selected"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button fx:id="SaveBtn" onAction="#handleSave" styleClass="page-button-selected" text="Generate Study Plan">
                <graphic>
                    <FontIcon iconLiteral="fas-calendar" iconSize="18" iconColor="white"/>
                </graphic>
            </Button>
        </HBox>

    </VBox>
</StackPane>
